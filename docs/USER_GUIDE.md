# PolyBot ユーザーガイド

PolyBot は Polymarket の価格を自動で監視し、あなたが設定したルールに従って売買シミュレーションを行うツールです。このガイドでは、プログラミングの知識がなくても PolyBot を使い始められるよう、画面の見方や操作方法を説明します。

---

## 目次

1. [PolyBot でできること](#1-polybot-でできること)
2. [はじめに：起動方法](#2-はじめに起動方法)
3. [ダッシュボード画面の見方](#3-ダッシュボード画面の見方)
4. [バックテスト画面の使い方](#4-バックテスト画面の使い方)
5. [通知の設定](#5-通知の設定)
6. [よくある質問](#6-よくある質問)
7. [用語集](#7-用語集)

---

## 1. PolyBot でできること

| 機能 | 説明 |
|------|------|
| 価格監視 | Polymarket のマーケット価格をリアルタイムで監視します |
| 自動売買シミュレーション | 設定したルールに基づいて売買判断をシミュレーションします |
| ダッシュボード | ブラウザで Bot の状態やポジション、損益を確認できます |
| バックテスト | 過去のデータを使って、戦略がどのくらい利益を出せたかテストできます |
| アラート通知 | 価格が大きく動いたとき Telegram や Discord に通知します |

---

## 2. はじめに：起動方法

### 必要なもの

- Docker Desktop がインストールされた PC
  - Windows: https://docs.docker.com/desktop/install/windows-install/
  - Mac: https://docs.docker.com/desktop/install/mac-install/
- Polymarket の API キー（API キーの取得は管理者にご確認ください）

### 起動手順

**手順 1.** Docker Desktop を起動します。

**手順 2.** ターミナル（Windows の場合はコマンドプロンプトまたは PowerShell）を開きます。

**手順 3.** PolyBot のフォルダに移動します。

```
cd polybot
```

**手順 4.** 以下のコマンドを入力して Enter を押します。

```
docker-compose up --build -d
```

初回は数分かかります。「Creating polybot-web ... done」のようなメッセージが表示されれば成功です。

**手順 5.** ブラウザで以下の URL を開きます。

```
http://localhost:8000
```

ダッシュボード画面が表示されます。

### 停止方法

PolyBot を停止するには、ターミナルで以下を入力します。

```
docker-compose down
```

---

## 3. ダッシュボード画面の見方

ブラウザで http://localhost:8000 を開くと表示される画面です。

### 画面構成

```
┌──────────┬──────────────────────────────────────┐
│          │                                      │
│  サイド   │  (1) ステータスカード                  │
│  バー     │  ┌──────┬──────────┬──────────┐      │
│          │  │Bot状態│ 合計資産  │ 日次損益  │      │
│ Dashboard│  └──────┴──────────┴──────────┘      │
│ Backtest │                                      │
│          │  (2) ポジション一覧   (3) パフォーマンス │
│ Polling  │  ┌────────────────┬────────────┐     │
│ [ON/OFF] │  │ テーブル        │ 勝率・PnL  │     │
│          │  └────────────────┴────────────┘     │
│          │                                      │
│          │  (4) システムログ                      │
│          │  ┌────────────────────────────┐      │
│          │  │ ログメッセージ               │      │
│          │  └────────────────────────────┘      │
└──────────┴──────────────────────────────────────┘
```

### (1) ステータスカード

画面上部に 3 つのカードが表示されます。

| カード | 説明 |
|--------|------|
| **Bot Status** | Bot が動作中なら緑色の「Running」、停止中なら赤色の「Stopped」 |
| **Total Assets** | 現在保有しているポジションの合計金額（USDC 単位） |
| **Daily PnL** | 本日の損益。プラスなら緑、マイナスなら赤で表示されます |

### (2) ポジション一覧（Active Positions）

現在保有しているポジションがテーブルで表示されます。

| 列 | 説明 |
|----|------|
| Market | マーケットの識別子 |
| Side | 買い（BUY = 緑）か売り（SELL = 赤）か |
| Size (USDC) | ポジションの大きさ（金額） |
| Avg Price | 平均取得価格 |
| PnL | そのポジションで確定した損益 |
| Opened | ポジションを開いた日時 |

ポジションがない場合は「No active positions」と表示されます。

### (3) パフォーマンス（Performance）

直近 7 日間の取引成績です。

| 項目 | 説明 |
|------|------|
| Total PnL | 期間内の合計損益 |
| Win Rate | 勝率（利益が出た取引の割合） |
| Total Trades | 総取引回数 |
| W / L | 勝ち回数 / 負け回数 |

### (4) システムログ（System Logs）

Bot の動作ログが新しい順に表示されます。色付きのラベルでログの重要度がわかります。

| ラベルの色 | 意味 |
|-----------|------|
| 青（INFO） | 通常の動作報告 |
| 黄（WARNING） | 注意が必要な状況 |
| 赤（ERROR） | エラーが発生 |

ログは自動で最新のものにスクロールします。過去のログを見たいときは上にスクロールすると自動スクロールが停止し、ゆっくり確認できます。

### Polling スイッチ

サイドバー下部にある「Polling」スイッチで、データの自動更新を ON/OFF できます。

- **ON（緑）**: 定期的にサーバーからデータを取得して画面を更新します
- **OFF**: データの自動更新を停止します（手動でページをリロードすれば更新されます）

---

## 4. バックテスト画面の使い方

サイドバーの「Backtest」をクリックすると、バックテスト画面に切り替わります。

バックテストとは、**過去のデータを使って「この戦略で取引していたらどうなっていたか」をシミュレーションする機能**です。

### 入力項目

| 項目 | 説明 | 初期値 |
|------|------|--------|
| **Period (days)** | 何日分の過去データでテストするか | 7 日 |
| **Market ID** | 特定のマーケットだけでテストしたい場合に入力（空欄なら全マーケット） | 空欄 |
| **Initial Capital (USDC)** | シミュレーション開始時の仮想資金 | 10,000 USDC |

### 実行方法

1. 各項目を必要に応じて変更します
2. 「**Execute Backtest**」ボタンをクリックします
3. 実行中はボタンに「Running...」と表示されます
4. 完了すると結果が下に表示されます

### 結果の見方

#### メトリクス（数値）

| 項目 | 説明 |
|------|------|
| **Initial Capital** | 開始時の資金 |
| **Final Capital** | 終了時の資金 |
| **Total PnL** | 合計損益（Final - Initial） |
| **Return** | リターン率（%） |
| **Win Rate** | 勝率（%） |
| **Sharpe** | シャープレシオ（リスクに対するリターンの効率。高いほど良い） |
| **Max Drawdown** | 最大ドローダウン（資産がピークからどれだけ下がったか。小さいほど安定） |
| **Total Trades** | 総取引回数 |

#### Equity Curve（資産推移グラフ）

横軸が時間、縦軸が資産額のグラフです。

- **右肩上がり** = 戦略が利益を出している
- **右肩下がり** = 戦略が損失を出している
- **上下に激しく動く** = リスクが高い戦略

#### 取引テーブル（Trades）

シミュレーション内で実行された売買の一覧です。

| 列 | 説明 |
|----|------|
| Action | BUY（買い）/ SELL（売り） |
| Price | 取引価格 |
| Amount (USDC) | 取引金額 |
| PnL | その取引の損益（SELL のときのみ意味がある） |
| Reason | 戦略が判断した理由 |

---

## 5. 通知の設定

PolyBot は価格が大きく変動したとき、Telegram や Discord に通知を送ることができます。

### Telegram 通知の設定

1. Telegram で **@BotFather** に話しかけ、`/newbot` コマンドで Bot を作成します
2. 発行された **Bot Token** を `.env` ファイルの `TELEGRAM_BOT_TOKEN` に記入します
3. 通知を受け取りたいチャットの **Chat ID** を `TELEGRAM_CHAT_ID` に記入します
4. PolyBot を再起動します

### Discord 通知の設定

1. Discord のサーバー設定 > 連携サービス > ウェブフック からウェブフックを作成します
2. 発行された **Webhook URL** を `.env` ファイルの `DISCORD_WEBHOOK_URL` に記入します
3. PolyBot を再起動します

### 通知される条件

初期設定では以下の場合に通知されます（`config/alerts.yaml` で変更可能）:

| アラート | 条件 |
|---------|------|
| 価格急落 | 価格が 0.10 未満、または 5 分間で 10% 以上下落 |
| 価格急騰 | 価格が 0.90 超、または 5 分間で 10% 以上上昇 |
| 大口取引 | 1,000 USDC を超える取引が発生 |

---

## 6. よくある質問

### Q. ダッシュボードに何も表示されません

Bot が起動しているか確認してください。ターミナルで以下を実行します:

```
docker-compose ps
```

`polybot` と `web` の両方が「Up」になっていれば正常です。起動直後はデータがまだ蓄積されていないため、ポジションや取引履歴が空なのは正常です。

### Q. 「No active positions」と表示されますが、問題ありませんか？

問題ありません。現在ポジションを持っていない（戦略が「待ち」の状態）ことを意味します。戦略の条件を満たす価格変動が起きると自動的にポジションが作られます。

### Q. バックテストで「戦略ファイルをロードできません」と出ます

`config/strategy.py` ファイルが存在するか確認してください。このファイルに売買ルールを記述する必要があります。

### Q. バックテストで「バックテスト用データがありません」と出ます

過去の価格データが蓄積されていない場合に表示されます。Bot を起動して数日間データを収集してから再度お試しください。

### Q. 戦略を変更したい場合はどうすればよいですか？

`config/strategy.py` をテキストエディタで編集し、PolyBot を再起動してください:

```
docker-compose restart polybot
```

戦略の書き方については管理者にご相談いただくか、`docs/AI_CO_PILOT_GUIDE.md` を参照してください。ChatGPT や Claude などの AI ツールに「PolyBot 用の戦略を作って」と依頼することもできます。

### Q. データをリセットしたい場合は？

PolyBot を停止し、データファイルを削除して再起動します:

```
docker-compose down
rm data/polybot.db
docker-compose up -d
```

**注意**: これまでの取引履歴やポジション情報がすべて消去されます。

### Q. PolyBot を常時動かし続けたい場合は？

`docker-compose.yml` に `restart: unless-stopped` が設定されているため、PC を再起動しても Docker Desktop が起動していれば自動的に PolyBot も起動します。

### Q. スマートフォンからダッシュボードを見られますか？

PolyBot を動かしている PC と同じネットワーク（Wi-Fi）に接続していれば、PC の IP アドレスを使ってアクセスできます。

例: PC の IP が `192.168.1.100` の場合
```
http://192.168.1.100:8000
```

ダッシュボードはスマートフォンの画面サイズにも対応しています。

---

## 7. 用語集

| 用語 | 説明 |
|------|------|
| **USDC** | Polymarket で使われるデジタル通貨。1 USDC = 約 1 米ドル |
| **ポジション** | 現在保有している売買の状態。「ポジションを持つ」＝何かを買っている |
| **PnL (Profit and Loss)** | 損益。プラスなら利益、マイナスなら損失 |
| **Daily PnL** | 本日の損益合計 |
| **勝率 (Win Rate)** | 全取引のうち利益が出た取引の割合 |
| **バックテスト** | 過去のデータを使った戦略のシミュレーション |
| **Equity Curve** | 資産の推移を示すグラフ |
| **シャープレシオ** | リスクに対するリターンの効率を示す指標。1.0 以上が良好とされる |
| **ドローダウン** | 資産がピークからどれだけ下落したかの割合。小さいほど安定 |
| **ポーリング** | 定期的にサーバーにデータを問い合わせる仕組み |
| **戦略 (Strategy)** | いつ買い、いつ売るかを決めるルール |
| **マーケット** | Polymarket 上の個別の予測市場（例：「次の大統領は誰？」） |
| **BUY / SELL / HOLD** | 買い / 売り / 何もしない（様子見） |
| **Docker** | アプリケーションを簡単に起動・管理するためのツール |
